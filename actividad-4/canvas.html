<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Auto Canvas</title>
    <style>
        body {
            width: 50%;
            height: 50%;
            border: 2px solid black;
        }
    </style>
</head>
<body>
<script>
class Rectangulo {
    constructor(x, y) {
        this.x = x;
        this.y = y;
        this.ancho = 100;
        this.alto = 50;
        this.angulo = 0;
    }

    dibujar(ctx) {
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(this.angulo);
        
        ctx.fillStyle = 'blue';
        ctx.fillRect(
            -this.ancho / 2,
            -this.alto / 2,
            this.ancho,
            this.alto
        );
        
        ctx.restore();
    }

    rotar(radianes) {
        this.angulo += radianes;
    }

    mover(distancia) {
        const dx = Math.cos(this.angulo) * distancia;
        const dy = Math.sin(this.angulo) * distancia;
        this.x += dx;
        this.y += dy;
    }
}

class ControladorRectangulo {
    constructor(rectangulo) {
        this.rectangulo = rectangulo;
        this.estadoTeclas = {};
        this.configurarEventosTeclado();
    }

    configurarEventosTeclado() {
        document.addEventListener('keydown', (e) => this.manejarKeyDown(e));
        document.addEventListener('keyup', (e) => this.manejarKeyUp(e));
    }

    manejarKeyDown(evento) {
        this.estadoTeclas[evento.key] = true;
    }

    manejarKeyUp(evento) {
        this.estadoTeclas[evento.key] = false;
    }

    actualizar() {
        const VELOCIDAD_ROTACION = 0.05;
        const VELOCIDAD_MOVIMIENTO = 2;

        if(this.estadoTeclas['ArrowUp']) this.rectangulo.mover(VELOCIDAD_MOVIMIENTO);
        if(this.estadoTeclas['ArrowDown']) this.rectangulo.mover(-VELOCIDAD_MOVIMIENTO);
        if(this.estadoTeclas['ArrowLeft']) this.rectangulo.rotar(-VELOCIDAD_ROTACION);
        if(this.estadoTeclas['ArrowRight']) this.rectangulo.rotar(VELOCIDAD_ROTACION);
    }
}


function main() {

    const canvas = document.createElement('canvas');
    canvas.width = 400;
    canvas.height = 400;
    document.body.appendChild(canvas);
    const ctx = canvas.getContext('2d');

    const rectangulo = new Rectangulo(200, 200);
    const controlador = new ControladorRectangulo(rectangulo);


    function limpiarCanvas() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    function buclePrincipal() {
        limpiarCanvas();
        controlador.actualizar();
        rectangulo.dibujar(ctx);
        requestAnimationFrame(buclePrincipal);
    }

    buclePrincipal();
}

window.onload = main;
</script>
</body>
</html>